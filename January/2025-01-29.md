## ğŸ“… ë‚ ì§œ: 2025-01-29


### ğŸ’¬ í•™ìŠµ ëª©í‘œ

- í•™ìŠµ ëª©í‘œ 1 : 5ì£¼ì°¨ ê³¼ì œ ì œì¶œí•˜ê¸°


### ğŸ“’ ì˜¤ëŠ˜ ê³µë¶€í•œ ë‚´ìš©
#### | 5ì£¼ì°¨ ê³¼ì œ

4. ì„œë²„ ì¬ì‹œì‘ shell script ì‘ì„±í•˜ê¸°

- ì›ë˜ ì½”ë“œ

`config.js`
```javascript
// const BASE_IP = 'http://express_ec2_publicIP:3001';
const BASE_IP = 'http://localhost:3001';

export default BASE_IP;
```
í™˜ê²½ì´ ë°”ë€”ë•Œë§ˆë‹¤(ë¡œì»¬(ê°œë°œ)<->ec2(ìš´ì˜)) beì˜ `config.js`ì˜ ì£¼ì„ì²˜ë¦¬ë¥¼ ìˆ˜ì •í•´ì„œ ë°”ê¿”ì¤Œ <br/>
ì´ë¿ë§Œì•„ë‹ˆë¼ `server.js` ì½”ë“œì˜ cors ì„¤ì •(origin_IP)ë„ í™˜ê²½ë°”ê¿€ë•Œë§ˆë‹¤ ìˆ˜ë™ìœ¼ë¡œ ìˆ˜ì •í•¨

+ í”„ë¡ íŠ¸ì—”ë“œì˜ BASE_IPë„ ë™ì¼í•œ ë¬¸ì œìˆìŒ (jsì½”ë“œë§ˆë‹¤ BASE_IP ìˆ˜ë™ë³€ê²½í•´ì•¼í•¨)
=> ì´ê±¸ ìŠ¤í¬ë¦½íŠ¸ë¡œ ìë™í™”ì‹œí‚¤ê³ ì í•¨

- ê³¼ì œ ì§„í–‰ ë‚´ìš©

    1. ë¡œì»¬ê³¼ ec2 í™˜ê²½ì— ì ìš©ë˜ëŠ” DB í™˜ê²½ë³€ìˆ˜ ë¶„ë¦¬í•˜ê¸°

        - `.env.local`
        
            ```bash
            BASE_IP=http://localhost:3001
            origin_IP=http://localhost:8080
            
            DB_HOST=127.0.0.1
            DB_USER=admin
            DB_PASSWORD='DB_password'
            DB_NAME=community_dev
            DB_PORT='DB_PORT'
            
            SECRET_KEY=siena_secretKey
            ```

        - `.env.prod`
        
            ```bash
            BASE_IP=http://express_ec2_publicIP:3001
            origin_IP=http://express_ec2_publicIP:8080
            
            DB_HOST='db_ec2_privateIP'
            DB_USER=admin
            DB_PASSWORD='DB_password'
            DB_NAME=community
            DB_PORT='DB_PORT'
            
            SECRET_KEY=siena_secretKey
            ```

    2. ê°œë°œ í™˜ê²½ ë° ìš´ì˜ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸

    db ec2ê°€ private IPë§Œ ìˆê³  express ec2ë‘ë§Œ ì—°ê²°ë˜ê²Œ í•´ë†”ì„œ ë¡œì»¬ì—ì„œ ì ‘ì†í•˜ë ¤ë©´ í„°ë„ë§í•´ì¤˜ì•¼í•¨!

    - `start_server.sh`

        ```bash
        #!/bin/bash

        # 1. í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ê²½ë¡œ ì„¤ì •
        if [ "$ENV" == "production" ]; then
        ENV_FILE="$HOME/2-siena-eom-community-be/.env.prod"
        else
        ENV_FILE="$HOME/Desktop/workspace/2-siena-eom-community-be/.env.local"
        fi

        # 2. í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ
        if [ -f "$ENV_FILE" ]; then
        export $(grep -v '^#' "$ENV_FILE" | xargs)
        else
        echo "Environment file not found: $ENV_FILE"
        exit 1
        fi

        # 3. CORS ë° API ì„¤ì • í™•ì¸
        echo "BASE_IP: $BASE_IP"
        echo "origin_IP: $origin_IP"

        # 4. SSH í„°ë„ë§ ì„¤ì • (ë¡œì»¬ í™˜ê²½ì—ì„œë§Œ ì‹¤í–‰)
        if [ "$ENV" != "production" ]; then
        echo "Setting up SSH tunnel for local environment..."
        
        # ê¸°ì¡´ í„°ë„ë§ í™•ì¸ ë° ì¢…ë£Œ
        EXISTING_TUNNEL=$(ps aux | grep "DB_PORT:db_ec2_privateIP:DB_PORT")
        if [ -n "$EXISTING_TUNNEL" ]; then
            echo "Existing SSH tunnel found. Closing it..."
            kill $(echo $EXISTING_TUNNEL | awk '{print $2}')
        fi

        # ìƒˆë¡œìš´ SSH í„°ë„ë§ ìƒì„±
        ssh -i "$HOME/Downloads/KeyPairs-1.pem" -f -N -L DB_PORT:db_ec2_privateIP:DB_PORT ubuntu@express_ec2_publicIP
        if [ $? -eq 0 ]; then
            echo "SSH tunnel established successfully."
        else
            echo "Failed to establish SSH tunnel."
            exit 1
        fi
        fi

        # 5. ì„œë²„ ì¬ì‹œì‘
        pm2 restart back --update-env
        pm2 restart front --update-env

        # 6. ì™„ë£Œ ë©”ì‹œì§€
        echo "Server restarted successfully with $ENV environment."
        ```

    - ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

        ```bash
        chmod +x start_server.sh
        ```

        1. ë¡œì»¬í™˜ê²½
            
            ```bash
            export ENV=local
            ./start_server.sh
            ```
            
        2. ìš´ì˜í™˜ê²½
            
            ```bash
            export ENV=production
            ./start_server.sh
            ```

    3. í”„ë¡ íŠ¸ì—”ë“œ config.js ì¶”ê°€í•˜ê¸°

        1. í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œ ë³€ê²½í•´ì£¼ê¸°
            1. js
                
                ```bash
                import BASE_IP from '../config.js';
                ```
                
            2. html
                
                ```html
                <script type="module" src="../js/login.js"></script>
                ```
                
            3. index.js
                
                ```jsx
                app.get('/config.js', (req, res) => {
                res.sendFile(path.join(__dirname, 'config.js'));
                });
                ```
        2. ìŠ¤í¬ë¦½íŠ¸ì— í”„ë¡ íŠ¸ì—”ë“œ ë””ë ‰í„°ë¦¬ì— config.js íŒŒì¼ì„ ìƒì„±í•˜ëŠ” ì½”ë“œ ì¶”ê°€



### ğŸ§‘â€ğŸ§’â€ğŸ§’ íŒ€ ìŠ¤í„°ë”” - ì½”ë”©í…ŒìŠ¤íŠ¸
#### | ë§¤ì¼ í•œ ë¬¸ì œ ì´ìƒ í’€ê¸°!

1. (ì˜¤ëŠ˜) ë‚´ê°€ í‘¼ ë¬¸ì œ

- 9ì£¼ì°¨
    - ë°±ì¤€ 5635, 1408

### ğŸ”¥ ë„ì „ ê³¼ì œ ë‹¬ì„± í™•ì¸, ë‚´ì¼ì˜ ë„ì „ê³¼ì œ ì„¤ì •
- (ì§€ë‚œ) ë„ì „ ê³¼ì œ 1: 5ì£¼ì°¨ ê³¼ì œ ì œì¶œí•˜ê¸° âœ…

- (ë‚´ì¼) ë„ì „ ê³¼ì œ 1: 6ì£¼ì°¨ ê³¼ì œ ì‹œì‘ ì „ ê³µë¶€í•˜ê¸°

<br/>

### ğŸ’­ ì˜¤ëŠ˜ì˜ íšŒê³  
- ì„±ê³µì ì¸ ì : ì™„ì „ ì˜¤ë˜.. ê³µë¶€í–ˆë‹¤.. <br/>
- ê°œì„ í•´ì•¼í•  ì : ë°¤ë‚®ì´ ë°”ë€Œì—ˆë‹¤.. ì§€ê¸ˆ ì˜¤ì „ 8ì‹œ 55ë¶„ì„...... <br/>


<br/>

### ğŸ“ ì°¸ê³  ìë£Œ ë° ë§í¬